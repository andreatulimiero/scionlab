{% extends 'scionlab/base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}User AS{% endblock %}

{% block content %}
<h1>AS {{ object.as_id }}</h1>


{% if userASForm.non_field_errors %}
  {{ userASForm.non_field_errors }}
{% endif %}
<form action="{% url 'user_as_detail' pk=object.pk %}" method="post">
  {% csrf_token %}
  <div class="form-box">
    <h2>Configuration</h2>
    {% for field in userASForm %}
      {{ field|as_crispy_field }}
    {% endfor %}
  </div>

  <h2>Attachment points</h2>
  {{ attachmentLinksFormSet.management_form }}
  {% for form in attachmentLinksFormSet %}
  {% if not form.initial %}
    <hr/>
    <h3>Add attachment point</h3>
  {% endif %}
  <div class="card">
    <div class="card-header">
      {% if form.initial %}
        {{ form.initial.attachment_point }}
        {% if form.initial.use_vpn %}<span class="badge badge-info">VPN</span>{% endif %}
        <div class="d-none">{{ form.attachment_point }}</div>
      {% else %}
        {{ form.attachment_point }}
      {% endif %}
    </div>
    <div class="card-body">
      {% for field in form %}
        {% if field != form.attachment_point %}
          {{ field|as_crispy_field }}
        {% endif %}
      {% endfor %}
    </div>
    {{ form.non_field_errors }}
  </div>
  {% endfor %}

  <br/>
  <em>Fields errors</em>
  <br/>
  {{ attachmentLinksFormSet.errors }}
  <br/>
  <em>Non fields errors</em>
  <br/>
  {{ attachmentLinksFormSet.non_form_errors }}
  <button type="submit" class="btn btn-primary savebtn">Save Changes</button>
</form>


{% comment %} {% if object.is_active %} {% endcomment %}
  {% comment %} <a class="ml-3" href="{% url 'user_as_config' pk=object.pk %}"><span class="fa fa-download"></span> Download configuration</a> {% endcomment %}
  {% comment %} <button type="submit" form="id_deactivate_form" class="btn btn-outline-danger pull-right">Deactivate this AS</button> {% endcomment %}
  {% comment %} <form id="id_deactivate_form" method="post" action="{% url 'user_as_deactivate' pk=object.pk %}">{% csrf_token %} {% endcomment %}
{% comment %} </form> {% endcomment %}
{% comment %} {% else %} {% endcomment %}
  {% comment %} <button type="submit" form="id_activate_form" class="btn btn-success pull-right">Activate this AS</button> {% endcomment %}
  {% comment %} <form id="id_activate_form" method="post" action="{% url 'user_as_activate' pk=object.pk %}">{% csrf_token %} {% endcomment %}
  {% comment %} </form> {% endcomment %}
{% comment %} {% endif %} {% endcomment %}

{% include "scionlab/partials/user_as_form_script.html" with attachment_points=attachment_points %}

{% endblock content %}
